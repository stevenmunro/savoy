/* NM: Shop infinite load script */
(function(f){f.extend(f.nmTheme,{infload_init:function(){var a=this.$shopBrowseWrap.children(".nm-pagination");a.length&&a.hasClass("nm-infload")&&this.shopInfLoadBind()},shopInfLoadBind:function(){var a=this,b=a.$shopBrowseWrap.children(".nm-infload-controls");a.shopInfLoadBound=!0;a.infloadScroll=b.hasClass("scroll-mode")?!0:!1;if(a.infloadScroll){a.infscrollLock=!1;var g,d=Math.round(a.$document.height()-b.offset().top),e=null;a.$window.resize(function(){e&&clearTimeout(e);e=setTimeout(function(){var c=
a.$shopBrowseWrap.children(".nm-infload-controls");d=Math.round(a.$document.height()-c.offset().top)},100)});a.$window.bind("smartscroll.infscroll",function(){a.infscrollLock||(g=0+a.$document.height()-a.$window.scrollTop()-a.$window.height(),g<d&&a.shopInfLoadGetPage())})}else b=f("#nm-shop-products"),b.on("click",".nm-infload-btn",function(c){c.preventDefault();a.shopInfLoadGetPage()}),b.on("click",".nm-infload-to-top",function(c){c.preventDefault();a.shopScrollToTop()});a.infloadScroll&&a.$window.trigger("scroll")},
shopInfLoadGetPage:function(){var a=this;if(a.shopAjax)return!1;a.shopRemoveNotices();var b=a.$shopBrowseWrap.children(".nm-infload-link").find("a"),g=a.$shopBrowseWrap.children(".nm-infload-controls"),d=b.attr("href");d?(d=a.updateUrlParameter(d,"shop_load","products"),g.addClass("nm-loader"),a.shopAjax=f.ajax({url:d,dataType:"html",cache:!1,headers:{"cache-control":"no-cache"},method:"GET",error:function(a,c,b){console.log("NM: AJAX error - shopInfLoadGetPage() - "+b)},complete:function(){g.removeClass("nm-loader")},
success:function(e){e=f("<div>"+e+"</div>");var c=e.children(".nm-products").children("li");c.addClass("hide");a.$shopBrowseWrap.find(".nm-products").append(c);setTimeout(function(){c.removeClass("hide")},300);(d=e.find(".nm-infload-link").children("a").attr("href"))?b.attr("href",d):(a.$shopBrowseWrap.addClass("all-products-loaded"),a.infloadScroll?a.infscrollLock=!0:g.addClass("hide-btn"),b.removeAttr("href"));a.shopAjax=!1;a.infloadScroll&&a.$window.trigger("scroll")}})):a.infloadScroll&&(a.infscrollLock=
!0)}});f.nmThemeExtensions.infload=f.nmTheme.infload_init})(jQuery);